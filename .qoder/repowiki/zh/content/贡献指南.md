# 贡献指南

<cite>
**本文档中引用的文件**
- [README.md](file://README.md)
- [pom.xml](file://pom.xml)
- [docs/developer.md](file://docs/developer.md)
- [test-support/src/main/java/com/github/dtprj/dongting/test/DtJunitListener.java](file://test-support/src/main/java/com/github/dtprj/dongting/test/DtJunitListener.java)
- [test-support/src/main/java/com/github/dtprj/dongting/test/Tick.java](file://test-support/src/main/java/com/github/dtprj/dongting/test/Tick.java)
- [test-support/src/main/java/com/github/dtprj/dongting/test/WaitUtil.java](file://test-support/src/main/java/com/github/dtprj/dongting/test/WaitUtil.java)
- [server/src/main/java/com/github/dtprj/dongting/fiber/Fiber.java](file://server/src/main/java/com/github/dtprj/dongting/fiber/Fiber.java)
- [demos/src/main/java/com/github/dtprj/dongting/demos/standalone/StandaloneDemoServer.java](file://demos/src/main/java/com/github/dtprj/dongting/demos/standalone/StandaloneDemoServer.java)
- [demos/src/main/java/com/github/dtprj/dongting/demos/base/DemoKvServerBase.java](file://demos/src/main/java/com/github/dtprj/dongting/demos/base/DemoKvServerBase.java)
</cite>

## 欢迎加入

感谢您对 Dongting 项目感兴趣！Dongting 是一个高性能的分布式系统引擎，集成了 RAFT 共识算法、配置服务器、消息队列和底层 RPC 功能。我们致力于打造一个零依赖、轻量级且高性能的分布式系统解决方案。

无论您是经验丰富的开发者还是刚刚入门的新手，我们都欢迎您为项目做出贡献。您的参与将帮助我们共同构建更好的开源项目！

## 项目概述

Dongting 项目是一个创新的高性能分布式系统引擎，具有以下特点：

- **高性能**：采用面向性能编程，支持每秒百万级别的吞吐量
- **零依赖**：不依赖任何第三方库，仅需 Java 8+ 运行时
- **轻量级**：两个 JAR 包总大小不到 1MB
- **多协议支持**：集成 RAFT、配置服务器、消息队列和 RPC
- **多版本兼容**：客户端支持 Java 8，服务端支持 Java 11

## 贡献类型

我们欢迎各种类型的贡献，包括但不限于：

### 新功能开发
- 实现新的分布式功能模块
- 扩展现有的 RAFT 算法功能
- 添加新的 RPC 协议支持
- 开发消息队列功能

### 性能优化
- 优化现有算法的性能
- 改进内存使用效率
- 提升并发处理能力
- 减少系统延迟

### 文档完善
- 完善技术文档和 API 文档
- 编写使用示例和教程
- 改进贡献指南
- 翻译文档到其他语言

### 测试改进
- 增加单元测试覆盖
- 编写集成测试用例
- 开发性能基准测试
- 改进测试工具和框架

### 错误修复
- 修复已知的 bug
- 优化错误处理逻辑
- 改进异常信息提示
- 增强系统稳定性

## 开发环境搭建

### 系统要求

- **Java 版本**：
  - 编译整个项目需要 Java 17
  - 客户端运行需要 Java 8+
  - 服务端运行需要 Java 11+
- **操作系统**：Windows、Linux、macOS
- **构建工具**：Maven 3.6+

### 快速开始

1. **克隆仓库**
```bash
git clone https://github.com/dtprj/dongting.git
cd dongting
```

2. **生成 Protobuf 文件**
```bash
mvn clean compile test-compile
```

3. **导入 IDE**：
   - 使用 IntelliJ IDEA 或 Eclipse 导入项目
   - 将生成的源文件路径添加到 IDE 的 sources 中

### 开发工具推荐

- **IDE**：IntelliJ IDEA Ultimate 或 Community Edition
- **插件**：Protobuf 插件、Maven 插件
- **调试器**：支持断点调试和远程调试
- **性能分析**：JProfiler、VisualVM

## 代码贡献流程

### 1. Fork 和 Clone

首先 Fork 项目到您的 GitHub 账户，然后克隆到本地：

```bash
git clone https://github.com/YOUR_USERNAME/dongting.git
cd dongting
git remote add upstream https://github.com/dtprj/dongting.git
```

### 2. 创建功能分支

```bash
git checkout -b feature/your-feature-name
```

### 3. 开发和测试

在开发过程中，请遵循以下最佳实践：

- **编写单元测试**：每个新功能都需要配套的单元测试
- **保持测试通过**：确保所有现有测试都能正常运行
- **性能测试**：对于性能相关修改，进行基准测试验证

### 4. 提交代码

```bash
git add .
git commit -m "feat: add new feature description"
git push origin feature/your-feature-name
```

### 5. 创建 Pull Request

1. 在 GitHub 上创建 Pull Request
2. 填写详细的描述，说明修改内容和原因
3. 关联相关的 Issue（如果有）
4. 等待代码审查和合并

## 代码风格和质量要求

### Java 代码规范

我们遵循标准的 Java 编码规范：

- **命名规范**：
  - 类名使用 PascalCase：`RaftServer`
  - 方法名和变量名使用 camelCase：`startServer`
  - 常量使用 UPPER_CASE：`MAX_RETRY_COUNT`
  - 接口名以 I 开头：`IRaftNode`

- **代码格式**：
  - 使用 4 个空格缩进
  - 行长度不超过 120 字符
  - 方法参数换行时对齐第一个参数
  - 大括号使用 K&R 风格

- **注释规范**：
  - 每个类必须有清晰的 Javadoc 注释
  - 复杂方法需要详细说明
  - 私有方法可以省略 Javadoc
  - 使用 `@param`、`@return`、`@throws` 标签

### 单元测试要求

- **覆盖率**：新功能测试覆盖率不低于 80%
- **测试命名**：测试方法使用 `methodNameTest` 格式
- **断言清晰**：使用有意义的断言消息
- **测试隔离**：每个测试应该独立运行

### 代码审查标准

- **功能正确性**：确保代码按预期工作
- **性能影响**：评估对系统性能的影响
- **可维护性**：代码是否易于理解和维护
- **安全性**：检查潜在的安全漏洞
- **兼容性**：确保向后兼容性

## 构建和测试项目

### 构建命令

```bash
# 清理并编译项目
mvn clean compile

# 运行测试
mvn test

# 生成测试报告
mvn jacoco:report

# 打包 JAR 文件
mvn package
```

### 运行演示程序

项目包含多个演示程序，可以直接运行：

```bash
# 单节点演示
java -cp target/dongting-demos-0.8.3-SNAPSHOT.jar \
  com.github.dtprj.dongting.demos.standalone.StandaloneDemoServer

# 集群演示
java -cp target/dongting-demos-0.8.3-SNAPSHOT.jar \
  com.github.dtprj.dongting.demos.cluster.DemoServer1
```

### 性能基准测试

```bash
# 运行 RAFT 基准测试
java -cp target/dongting-benchmark-0.8.3-SNAPSHOT.jar \
  com.github.dtprj.dongting.bench.raft.RaftBenchmark
```

## 测试工具和框架

### 自定义测试工具

项目提供了专门的测试工具来简化测试开发：

```java
// 等待条件满足
WaitUtil.waitUtil(() -> condition.get());

// 设置测试时间倍数
Tick.tick(10); // 将所有时间单位乘以 10

// JUnit 监听器
@TestExecutionListener
public class DtJunitListener implements TestExecutionListener {
    // 自动记录测试执行时间和结果
}
```

### 测试最佳实践

- **异步测试**：使用 Fiber 和等待工具处理异步操作
- **并发测试**：模拟高并发场景进行压力测试
- **故障注入**：模拟网络故障和节点宕机
- **性能测试**：监控内存使用和 CPU 占用

## 贡献者行为准则

我们致力于为所有贡献者创造一个友好、包容的环境：

### 我们承诺

- 尊重每一位贡献者
- 以建设性的方式提供建议
- 关注代码质量和功能价值
- 保持耐心和友善的态度

### 可接受的行为

- 使用专业和包容的语言
- 尊重不同的观点和经验
- 礼貌地接受建设性批评
- 专注于对社区最有利的事情

### 不可接受的行为

- 使用冒犯性或侮辱性的语言
- 进行人身攻击或政治攻击
- 公开或私下骚扰
- 发布他人私人信息
- 其他不专业的行为

## 获取帮助

如果您在贡献过程中遇到任何问题，可以通过以下方式获得帮助：

1. **GitHub Issues**：报告 bug 或提出功能请求
2. **邮件联系**：发送邮件至 areyouok@gmail.com
3. **社区讨论**：参与 GitHub Discussions
4. **文档参考**：查阅 README.md 和 developer.md

## 认可贡献

我们重视每一位贡献者的努力：

- **贡献者列表**：在 README 中列出主要贡献者
- **代码认可**：在 Pull Request 中给予适当的反馈
- **社区活动**：定期举办线上分享会
- **特别感谢**：在发布版本中感谢重要贡献

## 结语

再次感谢您考虑为 Dongting 项目做出贡献！您的参与将帮助我们共同构建一个更加强大和可靠的分布式系统平台。无论您是想修复一个小 bug，还是实现一个全新的功能，我们都欢迎您加入我们的开源之旅。

让我们一起创造更好的软件，让分布式系统变得更加简单和高效！